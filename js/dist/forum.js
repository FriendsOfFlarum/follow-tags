(()=>{var t={n:o=>{var n=o&&o.__esModule?()=>o.default:()=>o;return t.d(n,{a:n}),n},d:(o,n)=>{for(var s in n)t.o(n,s)&&!t.o(o,s)&&Object.defineProperty(o,s,{enumerable:!0,get:n[s]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};(()=>{"use strict";t.r(o),t.d(o,{components:()=>bt,utils:()=>et});const n=flarum.core.compat["forum/app"];var s=t.n(n);const r=flarum.core.compat["common/Model"];var i=t.n(r);const e=flarum.core.compat["common/extend"],a=flarum.core.compat["forum/components/IndexPage"];var l=t.n(a);const c=flarum.core.compat["forum/states/DiscussionListState"];var u=t.n(c);const f=function(){return"flarum-subscriptions"in flarum.extensions&&m.route.get().includes(s().route("following"))},p=flarum.core.compat["common/app"];var g,d=t.n(p);const b=function(t){return g||(g=["none","tags"].reduce((function(o,n){return o[n]=d().translator.trans("fof-follow-tags."+t+".following_"+n+"_label"),o}),{}))};var h,w=function(){return h||(h=b("forum.index.following")),h},v=function(){w();var t=s().data["fof-follow-tags.following_page_default"];if(h[t]||(t=null),s().session.user){var o=s().session.user.preferences().followTagsPageDefault;h[o]&&(t=o)}return t||"none"};function y(t,o){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},y(t,o)}function _(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,y(t,o)}const T=flarum.core.compat["common/Component"];var S=t.n(T);const N=flarum.core.compat["common/components/Button"];var O=t.n(N);const P=flarum.core.compat["common/components/Dropdown"];var I=t.n(P),x=function(t){function o(){return t.apply(this,arguments)||this}_(o,t);var n=o.prototype;return n.view=function(){var t=s().discussions.followTags,o=this.options();return I().component({buttonClassName:"Button",label:o[t]||v()},Object.keys(o).map((function(n){var r=n===t;return O().component({active:r,icon:!r||"fas fa-check",onclick:function(){s().discussions.followTags=n,s().discussions.refresh()}},o[n])})))},n.options=function(){return w()},o}(S());const D=flarum.core.compat["forum/components/Notification"];var j,k=t.n(D),K=function(t){function o(){return t.apply(this,arguments)||this}_(o,t);var n=o.prototype;return n.icon=function(){return"fas fa-user-tag"},n.href=function(){var t=this.attrs.notification.subject();return s().route.discussion(t)},n.content=function(){return s().translator.trans("fof-follow-tags.forum.notifications.new_discussion_text",{user:this.attrs.notification.fromUser(),title:this.attrs.notification.subject().title()})},n.excerpt=function(){return null},o}(k());const F=((j={})[!1]="fas fa-star",j.follow="fas fa-star",j.lurk="fas fa-comments",j.ignore="fas fa-bell-slash",j.hide="fas fa-eye-slash",j);var B=function(t){function o(){return t.apply(this,arguments)||this}_(o,t);var n=o.prototype;return n.icon=function(){return F.lurk},n.href=function(){var t=this.attrs.notification,o=t.subject(),n=t.content()||{};return s().route.discussion(o,n.postNumber)},n.content=function(){return s().translator.trans("fof-follow-tags.forum.notifications.new_post_text",{user:this.attrs.notification.fromUser()})},n.excerpt=function(){return null},o}(k()),C=function(t){function o(){return t.apply(this,arguments)||this}_(o,t);var n=o.prototype;return n.icon=function(){return"fas fa-user-tag"},n.href=function(){var t=this.attrs.notification.subject();return s().route.discussion(t)},n.content=function(){return s().translator.trans("fof-follow-tags.forum.notifications.new_discussion_tag_text",{user:this.attrs.notification.fromUser(),title:this.attrs.notification.subject().title()})},n.excerpt=function(){return null},o}(k());const M=flarum.core.compat["common/models/Discussion"];var A=t.n(M);const H=flarum.core.compat["common/components/Badge"];var q=t.n(H);const U=flarum.core.compat["forum/components/SettingsPage"];var L=t.n(U);const z=flarum.core.compat["common/components/FieldSet"];var E=t.n(z);const G=flarum.core.compat["common/components/Select"];var V=t.n(G);const J=flarum.core.compat["forum/components/NotificationGrid"];var Q=t.n(J);const R=flarum.core.compat["common/helpers/icon"];var W=t.n(R);const X=flarum.core.compat["common/helpers/textContrastClass"];var Y=t.n(X);const Z=flarum.core.compat["common/utils/classList"];var $=t.n(Z);const tt=flarum.core.compat["common/utils/ItemList"];var ot=t.n(tt),nt=function(t){function o(){return t.apply(this,arguments)||this}_(o,t);var n=o.prototype;return n.view=function(){var t,o=this.heroColor();return m("header",{className:$()("Hero","FollowingHero",(t={"FollowingHero--colored":o},t[Y()(o)]=o,t)),style:o?{"--hero-bg":o}:void 0},m("div",{className:"container"},this.viewItems().toArray()))},n.viewItems=function(){var t=new(ot());return t.add("content",m("div",{className:"containerNarrow"},this.contentItems().toArray()),80),t},n.contentItems=function(){var t=new(ot());return t.add("following-title",m("h1",{className:"Hero-title"},W()(this.heroIcon())," ",s().translator.trans("fof-follow-tags.forum.hero.title")),100),t},n.heroColor=function(){return null},n.heroIcon=function(){return"fas fa-star"},o}(S());function st(){return st=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var n=arguments[o];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},st.apply(this,arguments)}const rt=flarum.core.compat["common/components/Modal"];var it=t.n(rt),et=st({options:h,getOptions:w,getDefaultFollowingFiltering:v,isFollowingPage:f,subscriptionOptions:[{subscription:"not_follow",icon:"far fa-star",labelKey:"fof-follow-tags.forum.sub_controls.not_following_button",descriptionKey:"fof-follow-tags.forum.sub_controls.not_following_text"},{subscription:"follow",icon:"fas fa-star",labelKey:"fof-follow-tags.forum.sub_controls.following_button",descriptionKey:"fof-follow-tags.forum.sub_controls.following_text"},{subscription:"lurk",icon:"fas fa-eye",labelKey:"fof-follow-tags.forum.sub_controls.lurking_button",descriptionKey:"fof-follow-tags.forum.sub_controls.lurking_text"},{subscription:"ignore",icon:"fas fa-bell-slash",labelKey:"fof-follow-tags.forum.sub_controls.ignoring_button",descriptionKey:"fof-follow-tags.forum.sub_controls.ignoring_text"},{subscription:"hide",icon:"fas fa-eye-slash",labelKey:"fof-follow-tags.forum.sub_controls.hiding_button",descriptionKey:"fof-follow-tags.forum.sub_controls.hiding_text"}]},{followingPageOptions:b}),at=function(t){function o(){return t.apply(this,arguments)||this}return _(o,t),o.prototype.view=function(){var t=this.attrs.active;return m("div",{className:"SubscriptionOption "+(t?"selected":""),onclick:this.attrs.onclick},W()(this.attrs.icon,{className:"SubscriptionOption-icon"}),m("span",{className:"SubscriptionOption-title"},s().translator.trans(this.attrs.labelKey)),m("div",{className:"SubscriptionOption-description"},s().translator.trans(this.attrs.descriptionKey)),t&&W()("fas fa-check",{className:"SubscriptionOption-selectedIcon"}))},o}(S());const lt=flarum.core.compat["common/utils/Stream"];var ct=t.n(lt),ut=function(t){function o(){for(var o,n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(o=t.call.apply(t,[this].concat(s))||this).subscription=void 0,o.loading=void 0,o.canShowTooltip=void 0,o}_(o,t);var n=o.prototype;return n.oninit=function(o){var n;t.prototype.oninit.call(this,o),this.loading=ct()(!1),this.subscription=this.attrs.model.subscription()||"not_follow";var r=null==(n=s().session.user)?void 0:n.preferences(),i=r.notify_newPostInTag_email,e=r.notify_newPostInTag_alert;(i||e)&&"not_follow"===this.subscription?this.canShowTooltip=!0:this.canShowTooltip=!1},n.className=function(){return"SubscriptionModal Modal--medium"},n.title=function(){return s().translator.trans("fof-follow-tags.forum.sub_controls.header",{tagName:this.attrs.model.name()})},n.content=function(){var t,o=this,n=null==(t=s().session.user)?void 0:t.preferences();return n.notify_newPostInTag_email,n.notify_newPostInTag_alert,m("div",{className:"Modal-body"},this.formOptionItems().toArray(),m("div",{className:"Form-group"},m(O(),{className:"Button Button--primary",onclick:function(){return o.saveSubscription(o.subscription)},loading:this.loading()},s().translator.trans("fof-follow-tags.forum.sub_controls.submit_button"))))},n.formOptionItems=function(){var t=new(ot());return t.add("subscription_type",m("div",{className:"Form-group"},m("label",null,s().translator.trans("fof-follow-tags.forum.sub_controls.subscription_label",{tagName:this.attrs.model.name()})),this.subscriptionOptionItems().toArray()),60),t},n.subscriptionOptionItems=function(){var t=this,o=new(ot()),n=100;return et.subscriptionOptions.forEach((function(s,r){var i=st({},s,{onclick:function(){t.subscription=s.subscription,t.canShowTooltip=!1},active:t.subscription===s.subscription,disabled:"hide"===s.subscription&&t.attrs.model.isHidden()});o.add("subscription-option-"+r,m(at,i),n),n-=5})),o},n.saveSubscription=function(t){var o=this,n=this.attrs.model;this.loading(!0),this.subscription=t,s().request({url:s().forum.attribute("apiUrl")+"/tags/"+n.id()+"/subscription",method:"POST",body:{data:this.requestData()}}).then((function(t){return s().store.pushPayload(t)})).then((function(){o.loading(!1),m.redraw(),o.hide()}))},n.requestData=function(){return{subscription:this.subscription}},o}(it());const ft=flarum.core.compat["common/components/Tooltip"];var pt=t.n(ft);const mt=flarum.core.compat["common/utils/extractText"];var gt=t.n(mt),dt=function(t){function o(){return t.apply(this,arguments)||this}_(o,t);var n=o.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.loading=ct()(!1),this.canShowTooltip=ct()(!1)},n.onbeforeupdate=function(o){t.prototype.onbeforeupdate.call(this,o);var n=this.attrs.subscription||!1,r=s().session.user.preferences(),i=r.notify_newPostInTag_email,e=r.notify_newPostInTag_alert;(i||e)&&!1===n?this.canShowTooltip(void 0):this.canShowTooltip(!1)},n.view=function(o){var n=this.attrs.subscription||!1,r=et.subscriptionOptions.find((function(t){return t.subscription===n})),i=r?r.icon:"fas fa-star",e=r?s().translator.trans(r.labelKey):s().translator.trans("fof-follow-tags.forum.sub_controls.follow_button");this.attrs.className=(this.attrs.className||"")+" SubscriptionButton SubscriptionButton--"+n,this.attrs.icon=i;var a=s().session.user.preferences().notify_newPostInTag_email,l=gt()(s().translator.trans(a?"fof-follow-tags.forum.sub_controls.notify_email_tooltip":"fof-follow-tags.forum.sub_controls.notify_alert_tooltip"));return m(pt(),{text:"boolean"==typeof this.canShowTooltip()?"":l,tooltipVisible:this.canShowTooltip(),position:"bottom",delay:250},t.prototype.view.call(this,Object.assign({},o,{children:e})))},o}(O()),bt={FollowingPageFilterDropdown:x,NewDiscussionNotification:K,NewDiscussionTagNotification:C,NewPostNotification:B,SubscriptionModal:ut,SubscriptionOptionItem:at,SubscriptionStateButton:dt,FollowingHero:nt};s().initializers.add("fof/follow-tags",(function(){s().initializers.has("flarum-tags")?(s().store.models.tags.prototype.subscription=i().attribute("subscription"),(0,e.extend)(l().prototype,"sidebarItems",(function(t){if(this.currentTag()&&s().session.user){var o=this.currentTag();o&&(t.has("newDiscussion")&&t.setPriority("newDiscussion",10),t.add("subscriptionButton",m(dt,{className:"Button App-primaryControl",subscription:o.subscription(),onclick:function(){return s().modal.show(ut,{model:o})}}),5))}})),(0,e.override)(l().prototype,"hero",(function(t){return"following"===s().current.get("routeName")?m(nt,null):t()})),"flarum-subscriptions"in flarum.extensions&&((0,e.extend)(A().prototype,"badges",(function(t){if(f()&&this.tags()){var o=this.tags().map((function(t){return t.subscription()})).filter((function(t){return["lurk","follow"].includes(t)})),n=o.includes("lurk")?"lurking":"following";o.length&&t.add("followTags",q().component({label:s().translator.trans("fof-follow-tags.forum.badge."+n+"_tag_tooltip"),icon:"fas fa-user-tag",type:n+"-tag"}))}})),(0,e.extend)(u().prototype,"requestParams",(function(t){if(f()&&s().session.user){this.followTags||(this.followTags=v());var o=this.followTags;"following"===s().current.get("routeName")&&"tags"===o&&(t.filter["following-tag"]=!0,delete t.filter.subscription)}})),(0,e.extend)(l().prototype,"viewItems",(function(t){f()&&s().session.user&&t.add("follow-tags",m(x,null))})),(0,e.extend)(L().prototype,"settingsItems",(function(t){var o=this;t.add("fof-follow-tags",E().component({label:s().translator.trans("fof-follow-tags.forum.user.settings.heading"),className:"Settings-follow-tags"},[m("div",{className:"Form-group"},m("p",null,s().translator.trans("fof-follow-tags.forum.user.settings.filter_label")),V().component({options:w(),value:this.user.preferences().followTagsPageDefault||v(),onchange:function(t){o.user.savePreferences({followTagsPageDefault:t}).then((function(){m.redraw()}))}}))]))}))),s().notificationComponents.newPostInTag=B,s().notificationComponents.newDiscussionInTag=K,s().notificationComponents.newDiscussionTag=C,(0,e.extend)(Q().prototype,"notificationTypes",(function(t){t.add("newDiscussionInTag",{name:"newDiscussionInTag",icon:"fas fa-user-tag",label:s().translator.trans("fof-follow-tags.forum.settings.notify_new_discussion_label")}),t.add("newPostInTag",{name:"newPostInTag",icon:"fas fa-user-tag",label:s().translator.trans("fof-follow-tags.forum.settings.notify_new_post_label")}),t.add("newDiscussionTag",{name:"newDiscussionTag",icon:"fas fa-user-tag",label:s().translator.trans("fof-follow-tags.forum.settings.notify_new_discussion_tag_label")})}))):console.error("[fof/follow-tags] flarum/tags is not enabled")}),-1)})(),module.exports=o})();
//# sourceMappingURL=forum.js.map