(()=>{var t={n:o=>{var n=o&&o.__esModule?()=>o.default:()=>o;return t.d(n,{a:n}),n},d:(o,n)=>{for(var s in n)t.o(n,s)&&!t.o(o,s)&&Object.defineProperty(o,s,{enumerable:!0,get:n[s]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};(()=>{"use strict";t.r(o),t.d(o,{components:()=>ft,utils:()=>x});const n=flarum.core.compat["forum/app"];var s=t.n(n);const i=flarum.core.compat["common/extend"],r=flarum.core.compat["common/Model"];var e=t.n(r);const a=flarum.core.compat["forum/components/IndexPage"];var c=t.n(a);function l(){return l=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var n=arguments[o];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},l.apply(this,arguments)}function u(t,o){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},u(t,o)}function f(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,u(t,o)}const p=flarum.core.compat["common/components/Modal"];var g=t.n(p);const d=flarum.core.compat["common/components/Button"];var b=t.n(d);const h=flarum.core.compat["common/utils/ItemList"];var w=t.n(h);const v=flarum.core.compat["common/app"];var y,_=t.n(v);const T=function(t){return y||(y=["none","tags"].reduce((function(o,n){return o[n]=_().translator.trans("fof-follow-tags."+t+".following_"+n+"_label"),o}),{}))};var S,O=function(){return S||(S=T("forum.index.following")),S},P=function(){O();var t=s().data["fof-follow-tags.following_page_default"];if(S[t]||(t=null),s().session.user){var o=s().session.user.preferences().followTagsPageDefault;S[o]&&(t=o)}return t||"none"};const N=function(){return"flarum-subscriptions"in flarum.extensions&&m.route.get().includes(s().route("following"))};var x=l({options:S,getOptions:O,getDefaultFollowingFiltering:P,isFollowingPage:N,subscriptionOptions:[{subscription:"not_follow",icon:"far fa-star",labelKey:"fof-follow-tags.forum.sub_controls.not_following_button",descriptionKey:"fof-follow-tags.forum.sub_controls.not_following_text"},{subscription:"follow",icon:"fas fa-star",labelKey:"fof-follow-tags.forum.sub_controls.following_button",descriptionKey:"fof-follow-tags.forum.sub_controls.following_text"},{subscription:"lurk",icon:"fas fa-eye",labelKey:"fof-follow-tags.forum.sub_controls.lurking_button",descriptionKey:"fof-follow-tags.forum.sub_controls.lurking_text"},{subscription:"ignore",icon:"fas fa-bell-slash",labelKey:"fof-follow-tags.forum.sub_controls.ignoring_button",descriptionKey:"fof-follow-tags.forum.sub_controls.ignoring_text"},{subscription:"hide",icon:"fas fa-eye-slash",labelKey:"fof-follow-tags.forum.sub_controls.hiding_button",descriptionKey:"fof-follow-tags.forum.sub_controls.hiding_text"}]},{followingPageOptions:T});const I=flarum.core.compat["common/helpers/icon"];var D=t.n(I);const j=flarum.core.compat["common/Component"];var k=t.n(j),K=function(t){function o(){return t.apply(this,arguments)||this}return f(o,t),o.prototype.view=function(){var t=this.attrs.active;return m("div",{className:"SubscriptionOption "+(t?"selected":""),onclick:this.attrs.onclick},D()(this.attrs.icon,{className:"SubscriptionOption-icon"}),m("span",{className:"SubscriptionOption-title"},s().translator.trans(this.attrs.labelKey)),m("div",{className:"SubscriptionOption-description"},s().translator.trans(this.attrs.descriptionKey)),t&&D()("fas fa-check",{className:"SubscriptionOption-selectedIcon"}))},o}(k());const B=flarum.core.compat["common/utils/Stream"];var F=t.n(B),M=function(t){function o(){for(var o,n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return(o=t.call.apply(t,[this].concat(s))||this).subscription=void 0,o.loading=void 0,o.canShowTooltip=void 0,o}f(o,t);var n=o.prototype;return n.oninit=function(o){var n;t.prototype.oninit.call(this,o),this.loading=F()(!1),this.subscription=this.attrs.model.subscription()||"not_follow";var i=null==(n=s().session.user)?void 0:n.preferences(),r=i.notify_newPostInTag_email,e=i.notify_newPostInTag_alert;(r||e)&&"not_follow"===this.subscription?this.canShowTooltip=!0:this.canShowTooltip=!1},n.className=function(){return"SubscriptionModal Modal--medium"},n.title=function(){return s().translator.trans("fof-follow-tags.forum.sub_controls.header",{tagName:this.attrs.model.name()})},n.content=function(){var t,o=this,n=null==(t=s().session.user)?void 0:t.preferences();return n.notify_newPostInTag_email,n.notify_newPostInTag_alert,m("div",{className:"Modal-body"},this.formOptionItems().toArray(),m("div",{className:"Form-group"},m(b(),{className:"Button Button--primary",onclick:function(){return o.saveSubscription(o.subscription)},loading:this.loading()},s().translator.trans("fof-follow-tags.forum.sub_controls.submit_button"))))},n.formOptionItems=function(){var t=new(w());return t.add("subscription_type",m("div",{className:"Form-group"},m("label",null,s().translator.trans("fof-follow-tags.forum.sub_controls.subscription_label",{tagName:this.attrs.model.name()})),this.subscriptionOptionItems().toArray()),60),t},n.subscriptionOptionItems=function(){var t=this,o=new(w()),n=100;return x.subscriptionOptions.forEach((function(s,i){var r=l({},s,{onclick:function(){t.subscription=s.subscription,t.canShowTooltip=!1},active:t.subscription===s.subscription,disabled:"hide"===s.subscription&&t.attrs.model.isHidden()});o.add("subscription-option-"+i,m(K,r),n),n-=5})),o},n.saveSubscription=function(t){var o=this,n=this.attrs.model;this.loading(!0),this.subscription=t,s().request({url:s().forum.attribute("apiUrl")+"/tags/"+n.id()+"/subscription",method:"POST",body:{data:this.requestData()}}).then((function(t){return s().store.pushPayload(t)})).then((function(){o.loading(!1),m.redraw(),o.hide()}))},n.requestData=function(){return{subscription:this.subscription}},o}(g());const C=flarum.core.compat["common/components/Tooltip"];var q=t.n(C);const A=flarum.core.compat["common/utils/extractText"];var U=t.n(A),z=function(t){function o(){return t.apply(this,arguments)||this}f(o,t);var n=o.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.loading=F()(!1),this.canShowTooltip=F()(!1)},n.onbeforeupdate=function(o){t.prototype.onbeforeupdate.call(this,o);var n=this.attrs.subscription||!1,i=s().session.user.preferences(),r=i.notify_newPostInTag_email,e=i.notify_newPostInTag_alert;(r||e)&&!1===n?this.canShowTooltip(void 0):this.canShowTooltip(!1)},n.view=function(o){var n=this.attrs.subscription||!1,i=x.subscriptionOptions.find((function(t){return t.subscription===n})),r=i?i.icon:"fas fa-star",e=i?s().translator.trans(i.labelKey):s().translator.trans("fof-follow-tags.forum.sub_controls.follow_button");this.attrs.className=(this.attrs.className||"")+" SubscriptionButton SubscriptionButton--"+n,this.attrs.icon=r;var a=s().session.user.preferences().notify_newPostInTag_email,c=U()(s().translator.trans(a?"fof-follow-tags.forum.sub_controls.notify_email_tooltip":"fof-follow-tags.forum.sub_controls.notify_alert_tooltip"));return m(q(),{text:"boolean"==typeof this.canShowTooltip()?"":c,tooltipVisible:this.canShowTooltip(),position:"bottom",delay:250},t.prototype.view.call(this,Object.assign({},o,{children:e})))},o}(b());const L=flarum.core.compat["forum/states/DiscussionListState"];var E=t.n(L);const G=flarum.core.compat["common/components/Dropdown"];var H=t.n(G),V=function(t){function o(){return t.apply(this,arguments)||this}f(o,t);var n=o.prototype;return n.view=function(){var t=s().discussions.followTags,o=this.options();return H().component({buttonClassName:"Button",label:o[t]||P()},Object.keys(o).map((function(n){var i=n===t;return b().component({active:i,icon:!i||"fas fa-check",onclick:function(){s().discussions.followTags=n,s().discussions.refresh()}},o[n])})))},n.options=function(){return O()},o}(k());const J=flarum.core.compat["forum/components/Notification"];var Q,R=t.n(J),W=function(t){function o(){return t.apply(this,arguments)||this}f(o,t);var n=o.prototype;return n.icon=function(){return"fas fa-user-tag"},n.href=function(){var t=this.attrs.notification.subject();return s().route.discussion(t)},n.content=function(){return s().translator.trans("fof-follow-tags.forum.notifications.new_discussion_text",{user:this.attrs.notification.fromUser(),title:this.attrs.notification.subject().title()})},n.excerpt=function(){return null},o}(R());const X=((Q={})[!1]="fas fa-star",Q.follow="fas fa-star",Q.lurk="fas fa-comments",Q.ignore="fas fa-bell-slash",Q.hide="fas fa-eye-slash",Q);var Y=function(t){function o(){return t.apply(this,arguments)||this}f(o,t);var n=o.prototype;return n.icon=function(){return X.lurk},n.href=function(){var t=this.attrs.notification,o=t.subject(),n=t.content()||{};return s().route.discussion(o,n.postNumber)},n.content=function(){return s().translator.trans("fof-follow-tags.forum.notifications.new_post_text",{user:this.attrs.notification.fromUser()})},n.excerpt=function(){return null},o}(R()),Z=function(t){function o(){return t.apply(this,arguments)||this}f(o,t);var n=o.prototype;return n.icon=function(){return"fas fa-user-tag"},n.href=function(){var t=this.attrs.notification.subject();return s().route.discussion(t)},n.content=function(){return s().translator.trans("fof-follow-tags.forum.notifications.new_discussion_tag_text",{user:this.attrs.notification.fromUser(),title:this.attrs.notification.subject().title()})},n.excerpt=function(){return null},o}(R());const $=flarum.core.compat["common/models/Discussion"];var tt=t.n($);const ot=flarum.core.compat["common/components/Badge"];var nt=t.n(ot);const st=flarum.core.compat["forum/components/SettingsPage"];var it=t.n(st);const rt=flarum.core.compat["common/components/FieldSet"];var et=t.n(rt);const at=flarum.core.compat["common/components/Select"];var ct=t.n(at);const lt=flarum.core.compat["forum/components/NotificationGrid"];var ut=t.n(lt),ft={FollowingPageFilterDropdown:V,NewDiscussionNotification:W,NewDiscussionTagNotification:Z,NewPostNotification:Y,SubscriptionModal:M,SubscriptionOptionItem:K,SubscriptionStateButton:z};s().initializers.add("fof/follow-tags",(function(){s().initializers.has("flarum-tags")?(s().store.models.tags.prototype.subscription=e().attribute("subscription"),(0,i.extend)(c().prototype,"sidebarItems",(function(t){if(this.currentTag()&&s().session.user){var o=this.currentTag();t.has("newDiscussion")&&t.setPriority("newDiscussion",10),t.add("subscriptionButton",m(z,{className:"Button App-primaryControl",subscription:o.subscription(),onclick:function(){return s().modal.show(M,{model:o})}}),5)}})),"flarum-subscriptions"in flarum.extensions&&((0,i.extend)(tt().prototype,"badges",(function(t){if(N()&&this.tags()){var o=this.tags().map((function(t){return t.subscription()})).filter((function(t){return["lurk","follow"].includes(t)})),n=o.includes("lurk")?"lurking":"following";o.length&&t.add("followTags",nt().component({label:s().translator.trans("fof-follow-tags.forum.badge."+n+"_tag_tooltip"),icon:"fas fa-user-tag",type:n+"-tag"}))}})),(0,i.extend)(E().prototype,"requestParams",(function(t){if(N()&&s().session.user){this.followTags||(this.followTags=P());var o=this.followTags;"following"===s().current.get("routeName")&&"tags"===o&&(t.filter["following-tag"]=!0,delete t.filter.subscription)}})),(0,i.extend)(c().prototype,"viewItems",(function(t){N()&&s().session.user&&t.add("follow-tags",m(V,null))})),(0,i.extend)(it().prototype,"settingsItems",(function(t){var o=this;t.add("fof-follow-tags",et().component({label:s().translator.trans("fof-follow-tags.forum.user.settings.heading"),className:"Settings-follow-tags"},[m("div",{className:"Form-group"},m("p",null,s().translator.trans("fof-follow-tags.forum.user.settings.filter_label")),ct().component({options:O(),value:this.user.preferences().followTagsPageDefault||P(),onchange:function(t){o.user.savePreferences({followTagsPageDefault:t}).then((function(){m.redraw()}))}}))]))}))),s().notificationComponents.newPostInTag=Y,s().notificationComponents.newDiscussionInTag=W,s().notificationComponents.newDiscussionTag=Z,(0,i.extend)(ut().prototype,"notificationTypes",(function(t){t.add("newDiscussionInTag",{name:"newDiscussionInTag",icon:"fas fa-user-tag",label:s().translator.trans("fof-follow-tags.forum.settings.notify_new_discussion_label")}),t.add("newPostInTag",{name:"newPostInTag",icon:"fas fa-user-tag",label:s().translator.trans("fof-follow-tags.forum.settings.notify_new_post_label")}),t.add("newDiscussionTag",{name:"newDiscussionTag",icon:"fas fa-user-tag",label:s().translator.trans("fof-follow-tags.forum.settings.notify_new_discussion_tag_label")})}))):console.error("[fof/follow-tags] flarum/tags is not enabled")}),-1)})(),module.exports=o})();
//# sourceMappingURL=forum.js.map